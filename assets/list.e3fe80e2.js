import{I as p,X as v,i as $,r as l,o as m,t as N,m as c,l as r,v as h,H as y,T as k,U as E,M as g,w,W as I,L as V,k as S,a1 as B,G as x,u as F,S as H,O as M}from"./vendor.d47e90b9.js";import{_ as f,c as A,P as b}from"./index.3bbfb120.js";import{N as R}from"./NavBar.f3106687.js";import U from"./ProjectForm.9c84ecdf.js";import z from"./TableHeader.b8a94b5c.js";import D from"./TableBody.e547c27b.js";import{l as G}from"./lodash.b72579e9.js";import"./Translations.ae07918a.js";import"./ProjectItem.fae224a7.js";const K=p({name:"NavigationSideLogo",setup(){const e=v();return{title:$(()=>e.t("base.systemTitle"))}}}),O={class:"side-logo-container"},W=(e=>(k("data-v-4d0874bb"),e=e(),E(),e))(()=>h("img",{class:"side-logo-img",src:"/assets/vue.20be1948.svg",alt:"\u5546\u6807"},null,-1)),X={class:"side-logo-title"};var q=f(K,[["render",function(e,a,n,o,t,d){const s=l("router-link");return m(),N("div",O,[c(s,{to:`/${e.$route.params.locale||""}`},{default:r(()=>[W,h("h1",X,y(e.title),1)]),_:1},8,["to"])])}],["__scopeId","data-v-4d0874bb"]]);const J=p({name:"SearchSelect",props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},fetch:{type:Function,default:()=>()=>{}}},emits:["update:modelValue","change","select"],setup(e){const{proxy:a}=V(),n=g(!1),o=g("");return w(()=>e.modelValue,t=>{o.value=t},{immediate:!0}),w(()=>o,G.exports.debounce(function(t){a.$emit("update:modelValue",t),a.$emit("change",t)},300)),{loading:n,searchValue:o}},methods:{keydown(e){e.keyCode===229&&(e.returnValue=!1,e.stopPropagation()),e.keyCode===32&&(e.returnValue=!1)},getExecText:e=>e.replace(new RegExp(/(<([^>]+)>)/,"gi"),""),handleSelect({value:e}){this.$emit("select",e)},async handleSearch(e,a){const n=e.toLowerCase().replace(new RegExp(/[-[\]{}()*+?.,\\^$|#\s]/g),"\\$&");let o=[];if(!n)return void a(o);this.loading=!0,o=await this.fetch(n)||[],o.forEach(t=>{t.label=t.label.replace(new RegExp(n,"gi"),d=>`<span class="search-select-highlight">${d}</span>`)}),a(o),setTimeout(()=>{I(()=>{this.loading=!1})},200)}}}),Q=h("i",{class:"search-loading-icon el-input__icon el-icon-loading"},null,-1),Y=["title","innerHTML"],Z=p({name:"SearchCorporation",components:{SearchSelect:f(J,[["render",function(e,a,n,o,t,d){const s=l("IconFont"),u=l("el-autocomplete");return m(),S(u,x({modelValue:e.searchValue,"onUpdate:modelValue":a[0]||(a[0]=i=>e.searchValue=i),modelModifiers:{trim:!0}},e.$attrs,{class:"search-input-container",size:"medium","popper-class":"search-select-container","trigger-on-focus":!1,"fetch-suggestions":e.handleSearch,placeholder:e.placeholder,onSelect:e.handleSelect,onKeydownCapture:a[1]||(a[1]=i=>e.keydown(i))}),B({default:r(({item:i})=>[h("span",{title:e.getExecText(i.label),innerHTML:i.label},null,8,Y)]),_:2},[e.loading?{name:"suffix",fn:r(()=>[Q])}:{name:"suffix",fn:r(()=>[h("i",{class:"search-icon"},[c(s,{icon:"iconsearch"})])])}]),1040,["modelValue","fetch-suggestions","placeholder","onSelect"])}]])},emits:["select"],setup:()=>({searchValue:g("")}),methods:{handleFetchSearch:async e=>A.map(a=>({value:a,label:a})),handleSelectSearch(e){this.$emit("select",e)}}});var de=f(p({name:"ProjectList",components:{NavigationNavBar:R,NavigationSideLogo:q,ProjectTableHeader:z,ProjectTableBody:D,SearchCorporation:f(Z,[["render",function(e,a,n,o,t,d){const s=l("SearchSelect");return m(),S(s,x({modelValue:e.searchValue,"onUpdate:modelValue":a[0]||(a[0]=u=>e.searchValue=u),fetch:e.handleFetchSearch,placeholder:"\u641C\u7D22\u9879\u76EE","select-when-unmatched":"","highlight-first-item":""},e.$attrs,{onSelect:e.handleSelectSearch}),null,16,["modelValue","fetch","onSelect"])}]])},setup(){const{proxy:e}=V(),a=F(),n=v();function o(t){a.dispatch(b.getAction("getProjectList"),{kw:t})}return o(),{localeInject:n,handleCreateProject:function(){const t=M({name:"",corpName:"",notes:""});e.$ModalDialog({title:n.t("project.create"),top:"10vh",width:"50vw","show-close":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,renderComponent:{data:t,component:U},async onConfirm(d,s){if(!await d.validateRules())return Promise.reject(new Error("error"));s.fullLoading=!0;const{error:u,data:i}=await a.dispatch(b.getAction("createProject"),t);if(s.fullLoading=!1,u)return Promise.reject(new Error("error"));a.dispatch(b.getAction("getProjectList"))}})},handleSelectSearch:o}}}),[["render",function(e,a,n,o,t,d){const s=l("NavigationSideLogo"),u=l("NavigationNavBar"),i=l("IconFont"),P=l("el-button"),j=l("LayoutSection"),T=l("SearchCorporation"),_=l("ProjectTableHeader"),L=l("ProjectTableBody"),C=l("LayoutArea");return m(),S(C,null,{top:r(()=>[c(u,{fixed:!1},{default:r(()=>[c(s)]),_:1})]),side:r(()=>[c(j,{title:e.localeInject.t("project.manageTitle")},{default:r(()=>[c(P,{type:"primary",class:"create-action",onClick:a[0]||(a[0]=ee=>e.handleCreateProject())},{default:r(()=>[c(i,{icon:"iconestablish"}),H(" "+y(e._t("project.create")),1)]),_:1})]),_:1},8,["title"])]),content:r(()=>[c(j,{"has-divider":"","flex-content":""},{head:r(()=>[c(T,{onSelect:e.handleSelectSearch},null,8,["onSelect"])]),default:r(()=>[c(_),c(L)]),_:1})]),_:1})}],["__scopeId","data-v-02de9c7c"]]);export{de as default};
