import{d as f,u as w,f as N,_ as g,r as o,o as S,b as T,g as r,w as c,e as h,t as b,p as E,h as I,l as B,i as _,j as V,n as F,k as j,c as $,m as x,q as C,s as M,v as A,x as H,P as y,y as R}from"./index-9db6f290.js";import{N as D}from"./NavBar-d9a54785.js";import q from"./ProjectForm-e4202a2e.js";import U from"./TableHeader-7959b626.js";import O from"./TableBody-fbaa597b.js";import{l as K}from"./lodash-787538fa.js";import"./Translations-209dbf5d.js";import"./ProjectItem-34fb560d.js";const z=f({name:"NavigationSideLogo",setup(){const e=w();return{title:N(()=>e.t("base.systemTitle"))}}}),G=""+new URL("vue-20be1948.svg",import.meta.url).href;const J=e=>(E("data-v-f1bcf7c3"),e=e(),I(),e),Q={class:"side-logo-container"},W=J(()=>h("img",{class:"side-logo-img",src:G,alt:"商标"},null,-1)),X={class:"side-logo-title"};function Y(e,t,l,a,s,d){const n=o("router-link");return S(),T("div",Q,[r(n,{to:`/${e.$route.params.locale||""}`},{default:c(()=>[W,h("h1",X,b(e.title),1)]),_:1},8,["to"])])}const Z=g(z,[["render",Y],["__scopeId","data-v-f1bcf7c3"]]),ee=f({name:"SearchSelect",components:{Loading:B},props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},fetch:{type:Function,default(){return()=>{}}}},emits:["update:modelValue","change","select"],setup(e){const{proxy:t}=j(),l=_(!1),a=_("");return V(()=>e.modelValue,s=>{a.value=s},{immediate:!0}),V(()=>a,K.debounce(function(s){t.$emit("update:modelValue",s),t.$emit("change",s)},300)),{loading:l,searchValue:a}},methods:{keydown(e){e.keyCode===229&&(e.returnValue=!1,e.stopPropagation()),e.keyCode===32&&(e.returnValue=!1)},getExecText(e){return e.replace(new RegExp(/(<([^>]+)>)/,"gi"),"")},handleSelect({value:e}){this.$emit("select",e)},async handleSearch(e,t){const l=e.toLowerCase().replace(new RegExp(/[-[\]{}()*+?.,\\^$|#\s]/g),"\\$&");let a=[];if(!l){t(a);return}this.loading=!0,a=await this.fetch(l)||[],a.forEach(d=>{d.label=d.label.replace(new RegExp(l,"gi"),n=>`<span class="search-select-highlight">${n}</span>`)}),t(a),setTimeout(()=>{F(()=>{this.loading=!1})},200)}}});const te=["title","innerHTML"];function oe(e,t,l,a,s,d){const n=o("loading"),u=o("el-icon"),p=o("IconFont"),m=o("el-autocomplete");return S(),$(m,C({modelValue:e.searchValue,"onUpdate:modelValue":t[0]||(t[0]=i=>e.searchValue=i),modelModifiers:{trim:!0}},e.$attrs,{class:"search-input-container","popper-class":"search-select-container","trigger-on-focus":!1,"fetch-suggestions":e.handleSearch,placeholder:e.placeholder,onSelect:e.handleSelect,onKeydownCapture:t[1]||(t[1]=i=>e.keydown(i))}),x({default:c(({item:i})=>[h("span",{title:e.getExecText(i.label),innerHTML:i.label},null,8,te)]),_:2},[e.loading?{name:"suffix",fn:c(()=>[r(u,{class:"search-loading-icon"},{default:c(()=>[r(n)]),_:1})]),key:"0"}:{name:"suffix",fn:c(()=>[h("i",{class:"search-icon"},[r(p,{icon:"iconsearch"})])]),key:"1"}]),1040,["modelValue","fetch-suggestions","placeholder","onSelect"])}const ae=g(ee,[["render",oe]]),ne=f({name:"SearchCorporation",components:{SearchSelect:ae},emits:["select"],setup(){return{searchValue:_("")}},methods:{async handleFetchSearch(e){return M.map(t=>({value:t,label:t}))},handleSelectSearch(e){this.$emit("select",e)}}});function se(e,t,l,a,s,d){const n=o("SearchSelect");return S(),$(n,C({modelValue:e.searchValue,"onUpdate:modelValue":t[0]||(t[0]=u=>e.searchValue=u),fetch:e.handleFetchSearch,placeholder:"搜索项目","select-when-unmatched":"","highlight-first-item":""},e.$attrs,{onSelect:e.handleSelectSearch}),null,16,["modelValue","fetch","onSelect"])}const re=g(ne,[["render",se]]),ce=f({name:"ProjectList",components:{NavigationNavBar:D,NavigationSideLogo:Z,ProjectTableHeader:U,ProjectTableBody:O,SearchCorporation:re},setup(){const{proxy:e}=j(),t=A(),l=w();function a(){const n=H({name:"",corpName:"",notes:""});e.$ModalDialog({title:l.t("project.create"),top:"10vh",width:"50vw",showClose:!0,closeOnClickModal:!1,closeOnPressEscape:!1,renderComponent:{data:n,component:q},async onConfirm(u,p){if(!await u.validateRules())return Promise.reject(new Error("error"));p.fullLoading=!0;const{error:i,data:v}=await t.dispatch(y.getAction("createProject"),n);if(p.fullLoading=!1,i)return Promise.reject(new Error("error"));t.dispatch(y.getAction("getProjectList"))}})}const s=_(!0),d=async n=>{s.value=!0,await t.dispatch(y.getAction("getProjectList"),{kw:n}),s.value=!1};return d(),{localeInject:l,loadingContent:s,handleCreateProject:a,handleSelectSearch:d}}});function le(e,t,l,a,s,d){const n=o("NavigationSideLogo"),u=o("NavigationNavBar"),p=o("IconFont"),m=o("el-button"),i=o("LayoutSection"),v=o("SearchCorporation"),L=o("ProjectTableHeader"),P=o("ProjectTableBody"),k=o("LayoutArea");return S(),$(k,null,{top:c(()=>[r(u,{fixed:!1},{default:c(()=>[r(n)]),_:1})]),side:c(()=>[r(i,{title:e.localeInject.t("project.manageTitle")},{default:c(()=>[r(m,{type:"primary",class:"create-action",onClick:t[0]||(t[0]=ie=>e.handleCreateProject())},{default:c(()=>[r(p,{icon:"iconestablish"}),R(" "+b(e._t("project.create")),1)]),_:1})]),_:1},8,["title"])]),content:c(()=>[r(i,{"has-divider":"","flex-content":"",loading:e.loadingContent},{head:c(()=>[r(v,{onSelect:e.handleSelectSearch},null,8,["onSelect"])]),default:c(()=>[r(L),r(P)]),_:1},8,["loading"])]),_:1})}const Se=g(ce,[["render",le],["__scopeId","data-v-a6eba1ee"]]);export{Se as default};
