import{u as k}from"./vuex.esm-bundler-23d4d71e.js";import{c as N,P as S}from"./index-8e1d9fed.js";import{u as V}from"./index-f4d7bb70.js";import{x as h,e as I,ai as _,y as g,z as E,P as n,I as r,a7 as o,A as f,O as b,ak as B,al as F,r as $,w as v,S as x,H as y,a1 as A,T as w,V as H,M}from"./_plugin-vue_export-helper-151d577c.js";import{N as R}from"./NavBar-ce7df45e.js";import D from"./ProjectForm-bba6e93e.js";import U from"./TableHeader-5273a753.js";import q from"./TableBody-3b3b4659.js";import{l as z}from"./index-3614a382.js";import{l as K}from"./lodash-e9f1b42e.js";import{u as j}from"./useCurrentInstance-3056fcb5.js";import"./index-f9466fc7.js";import"./type-2615e4ee.js";import"./index-8b552cd8.js";import"./mixin-14af9aba.js";import"./Translations-4f235def.js";import"./useBaseStore-789d49b0.js";import"./ProjectItem-b4f48181.js";import"./_commonjsHelpers-725317a4.js";const O=h({name:"NavigationSideLogo",setup(){const e=V();return{title:I(()=>e.t("base.systemTitle"))}}}),G=""+new URL("vue-20be1948.svg",import.meta.url).href;const J=e=>(B("data-v-f1bcf7c3"),e=e(),F(),e),Q={class:"side-logo-container"},W=J(()=>f("img",{class:"side-logo-img",src:G,alt:"商标"},null,-1)),X={class:"side-logo-title"};function Y(e,t,s,a,c,l){const i=o("router-link");return g(),E("div",Q,[n(i,{to:`/${e.$route.params.locale||""}`},{default:r(()=>[W,f("h1",X,b(e.title),1)]),_:1},8,["to"])])}const Z=_(O,[["render",Y],["__scopeId","data-v-f1bcf7c3"]]),ee=h({name:"SearchSelect",components:{Loading:z},props:{modelValue:{type:String,default:""},placeholder:{type:String,default:""},fetch:{type:Function,default(){return()=>{}}}},emits:["update:modelValue","change","select"],setup(e){const{proxy:t}=j(),s=$(!1),a=$("");return v(()=>e.modelValue,c=>{a.value=c},{immediate:!0}),v(()=>a,K.exports.debounce(function(c){t.$emit("update:modelValue",c),t.$emit("change",c)},300)),{loading:s,searchValue:a}},methods:{keydown(e){e.keyCode===229&&(e.returnValue=!1,e.stopPropagation()),e.keyCode===32&&(e.returnValue=!1)},getExecText(e){return e.replace(new RegExp(/(<([^>]+)>)/,"gi"),"")},handleSelect({value:e}){this.$emit("select",e)},async handleSearch(e,t){const s=e.toLowerCase().replace(new RegExp(/[-[\]{}()*+?.,\\^$|#\s]/g),"\\$&");let a=[];if(!s){t(a);return}this.loading=!0,a=await this.fetch(s)||[],a.forEach(l=>{l.label=l.label.replace(new RegExp(s,"gi"),i=>`<span class="search-select-highlight">${i}</span>`)}),t(a),setTimeout(()=>{x(()=>{this.loading=!1})},200)}}});const te=["title","innerHTML"];function oe(e,t,s,a,c,l){const i=o("loading"),d=o("el-icon"),m=o("IconFont"),u=o("el-autocomplete");return g(),y(u,w({modelValue:e.searchValue,"onUpdate:modelValue":t[0]||(t[0]=p=>e.searchValue=p),modelModifiers:{trim:!0}},e.$attrs,{class:"search-input-container","popper-class":"search-select-container","trigger-on-focus":!1,"fetch-suggestions":e.handleSearch,placeholder:e.placeholder,onSelect:e.handleSelect,onKeydownCapture:t[1]||(t[1]=p=>e.keydown(p))}),A({default:r(({item:p})=>[f("span",{title:e.getExecText(p.label),innerHTML:p.label},null,8,te)]),_:2},[e.loading?{name:"suffix",fn:r(()=>[n(d,{class:"search-loading-icon"},{default:r(()=>[n(i)]),_:1})]),key:"0"}:{name:"suffix",fn:r(()=>[f("i",{class:"search-icon"},[n(m,{icon:"iconsearch"})])]),key:"1"}]),1040,["modelValue","fetch-suggestions","placeholder","onSelect"])}const ae=_(ee,[["render",oe]]),ne=h({name:"SearchCorporation",components:{SearchSelect:ae},emits:["select"],setup(){return{searchValue:$("")}},methods:{async handleFetchSearch(e){return N.map(t=>({value:t,label:t}))},handleSelectSearch(e){this.$emit("select",e)}}});function re(e,t,s,a,c,l){const i=o("SearchSelect");return g(),y(i,w({modelValue:e.searchValue,"onUpdate:modelValue":t[0]||(t[0]=d=>e.searchValue=d),fetch:e.handleFetchSearch,placeholder:"搜索项目","select-when-unmatched":"","highlight-first-item":""},e.$attrs,{onSelect:e.handleSelectSearch}),null,16,["modelValue","fetch","onSelect"])}const se=_(ne,[["render",re]]),ce=h({name:"ProjectList",components:{NavigationNavBar:R,NavigationSideLogo:Z,ProjectTableHeader:U,ProjectTableBody:q,SearchCorporation:se},setup(){const{proxy:e}=j(),t=k(),s=V();function a(){const l=H({name:"",corpName:"",notes:""});e.$ModalDialog({title:s.t("project.create"),top:"10vh",width:"50vw","show-close":!0,"close-on-click-modal":!1,"close-on-press-escape":!1,renderComponent:{data:l,component:D},async onConfirm(i,d){if(!await i.validateRules())return Promise.reject(new Error("error"));d.fullLoading=!0;const{error:u,data:p}=await t.dispatch(S.getAction("createProject"),l);if(d.fullLoading=!1,u)return Promise.reject(new Error("error"));t.dispatch(S.getAction("getProjectList"))}})}function c(l){t.dispatch(S.getAction("getProjectList"),{kw:l})}return c(),{localeInject:s,handleCreateProject:a,handleSelectSearch:c}}});function le(e,t,s,a,c,l){const i=o("NavigationSideLogo"),d=o("NavigationNavBar"),m=o("IconFont"),u=o("el-button"),p=o("LayoutSection"),L=o("SearchCorporation"),P=o("ProjectTableHeader"),C=o("ProjectTableBody"),T=o("LayoutArea");return g(),y(T,null,{top:r(()=>[n(d,{fixed:!1},{default:r(()=>[n(i)]),_:1})]),side:r(()=>[n(p,{title:e.localeInject.t("project.manageTitle")},{default:r(()=>[n(u,{type:"primary",class:"create-action",onClick:t[0]||(t[0]=ie=>e.handleCreateProject())},{default:r(()=>[n(m,{icon:"iconestablish"}),M(" "+b(e._t("project.create")),1)]),_:1})]),_:1},8,["title"])]),content:r(()=>[n(p,{"has-divider":"","flex-content":""},{head:r(()=>[n(L,{onSelect:e.handleSelectSearch},null,8,["onSelect"])]),default:r(()=>[n(P),n(C)]),_:1})]),_:1})}const Te=_(ce,[["render",le],["__scopeId","data-v-35f8bb3f"]]);export{Te as default};
